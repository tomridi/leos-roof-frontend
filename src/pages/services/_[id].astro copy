---
import Layout from '../../layouts/Layout.astro';
import type { ServiceDoc, MediaAsset } from '../../types/payload.ts'; // Ensure this path is correct


//About Components
import EmergencyCall from '../../components/EmergencyCall.astro';
import Testimonial from '../../components/Testimonial.astro';
import Slideshow from '../../components/Slideshow.tsx';


const PAYLOAD_CMS_URL: string = import.meta.env.PUBLIC_PAYLOAD_API_URL || "http://localhost:3000/api";

// 1. Define getStaticPaths to pre-generate paths for all services
export async function getStaticPaths() {
  try {
    const response = await fetch(`${PAYLOAD_CMS_URL}/services`); // Fetch ALL services
    if (!response.ok) {
      throw new Error(`Failed to fetch services for static paths: ${response.statusText}`);
    }
    const data = await response.json();
    const services: ServiceDoc[] = data.docs || []; // Payload returns 'docs' array for collections

    // Map services to paths and pass the full service object as props
    return services.map((service) => ({
      params: { id: String(service.id) }, // params MUST be strings
      props: { service: service }, // Pass the entire service object as a prop
    }));
  } catch (error) {
    console.error('Error in getStaticPaths for services:', error);
    // In a real application, you might want to log this error and gracefully handle it
    // For now, we'll return an empty array, which will result in no service pages being generated.
    return [];
  }
}

const { service } = Astro.props;


// Handle case where service is not found or an error occurred
if (!service) {
  return Astro.redirect('/404'); // Redirect to a 404 page or display an error
}

// Prepare image data for the Slideshow component
const slideshowImages = service.gallery.map(item => ({
  src: item.image.url,
  alt: item.caption || service.title, // Use caption if available, otherwise service title
}));



//SEO CONFIG PAGE BY PAGE
const pagetitle = `${service.title} - `;
const description = service.description || "Learn more about our services at Leo's Roofing & Remodeling.";

---

<Layout title={pagetitle} description={description}>
    <section class="flex flex-col bg-gray-light pt-10 md:pt-25">
        <div class="flex-grow container mx-auto
        text-left px-4 md:px-0 py-15 
        content-start">
            <h1 class="font-thin text-2xl md:text-4xl max-w-3/4">
                {service.title}
            </h1>

            <div class="mt-7 md:mt-10 md:bg-white">
                <div class="h-[300px] md:h-[430px] w-auto overflow-hidden">
                    <Slideshow images={slideshowImages} interval={4000} arrows={true} custom_arrows={false} caption={false} bullets={true} client:load />
                </div>
            </div>

            <div class="bg-white mt-8 mb-8 md:mb-0 md:mt-0 py-5 md:py-10 px-3 md:px-20">
                        <span class="font-semibold block">Metal Work</span>
                    <p>
Metal roofing and siding offer exceptional durability, energy efficiency, and a distinct modern appeal—perfect for the harsh, snowy climates of Summit County, Grand County, and beyond. At Leo’s Roofing & Remodeling, our custom fabrication ensures every piece fits your property’s dimensions and style, whether you want a full metal roof, partial coverage in high-accumulation spots, or even interior metal accents. Pre-applied paint warranties often last 30 years or more, minimizing maintenance and giving you long-lasting color and protection against the elements.
                    </p>
                    <p class="mt-5">
Though metal solutions can have a higher upfront cost than other options like shingles or traditional siding, they often prove more cost-effective over time thanks to reduced maintenance and superior longevity. Metal roofing, in particular, is an excellent choice for homeowners seeking longevity and a unique architectural statement, and we can review different types of metal roofs—from standing seam to corrugated panels— to match your style and budget. This is particularly valuable in mountain environments, where heavy snowfall, ice dams, and high winds can severely stress conventional materials. If you’re looking for a balance of strength and style, metal is an investment that stands up to Summit County’s toughest weather.
                    </p>
            </div>
            
                <div class="h-[240px] md:h-[445px] overflow-hidden">
                    <img src="/images/service-individual-placeholder.webp" alt="Metal roofing example" class="w-full h-full object-cover object-center " loading="lazy">
                </div>
            <div class="bg-white mt-8 mb-0 md:mt-0 py-5 md:py-10 px-3 md:px-20">
                        <span class="font-semibold block">Metal Work</span>
                    <p>
Metal roofing and siding offer exceptional durability, energy efficiency, and a distinct modern appeal—perfect for the harsh, snowy climates of Summit County, Grand County, and beyond. At Leo’s Roofing & Remodeling, our custom fabrication ensures every piece fits your property’s dimensions and style, whether you want a full metal roof, partial coverage in high-accumulation spots, or even interior metal accents. Pre-applied paint warranties often last 30 years or more, minimizing maintenance and giving you long-lasting color and protection against the elements.
                    </p>
                    <p class="mt-5">
Though metal solutions can have a higher upfront cost than other options like shingles or traditional siding, they often prove more cost-effective over time thanks to reduced maintenance and superior longevity. Metal roofing, in particular, is an excellent choice for homeowners seeking longevity and a unique architectural statement, and we can review different types of metal roofs—from standing seam to corrugated panels— to match your style and budget. This is particularly valuable in mountain environments, where heavy snowfall, ice dams, and high winds can severely stress conventional materials. If you’re looking for a balance of strength and style, metal is an investment that stands up to Summit County’s toughest weather.
                    </p>
            </div>


                <div class="bg-light-blue py-5 md:py-10 px-3 md:px-20">
                        <span class="font-semibold mb-5 block">Ready to Elevate Your Property with Metal?</span>
                    <p>
Whether you’re upgrading entire exteriors mixing shingles and metal for cost efficiency, or adding a modern accent to an interior wall, Leo’s Roofing & Remodeling has you covered. Our hands-on process, custom fabrication and commitment to long-term performance make metal an excellent investment for any mountain property.
                    </p> 
                    <p class="mt-5">
                        Reach out today to discuss your next metal roofing or siding project. We’ll guide you through design, installation, and seasonal maintenance, ensuring your home or business stays protected and stylish for decades to come.
                    </p> 
                </div>
            <div class="flex justify-between text-sm md:text-3xl font-thin mt-10">
               <a href="#" class="hover:text-background flex items-center">
                    <div class="cursor-pointer pr-3 md:pr-5">
                        <svg class="h-4 md:h-8 w-auto" viewBox="0 0 35 31" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M0 15.4967L35 0V31L0 15.4967Z" fill="currentColor"/>
                        </svg>
                    </div>
                    <div>Previous</div>
                </a>
                <a href="#" class="hover:text-background flex items-center">
                    <div class="pr-3 md:pr-5">Next</div>
                    <div class="cursor-pointer">
                        <svg class="h-4 md:h-8 w-auto" viewBox="0 0 35 31" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M0 31V0L35 15.4967" fill="currentColor"/>
                        </svg>
                    </div>
                </a>
            </div>

        </div>

    </section>
    <EmergencyCall />
    <Testimonial />
</Layout>